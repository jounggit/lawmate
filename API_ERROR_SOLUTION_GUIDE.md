# 법률 API 접근 오류 해결 가이드

이 문서는 법률정보센터 API 접근 시 발생하는 오류 및 해결 방법에 대한 가이드입니다.

## 오류 증상

법률정보센터 API 호출 시 다음과 같은 오류가 발생할 수 있습니다:

```
법령 검색 파라미터: {'OC': 'jhb1107', 'target': 'law', 'type': 'XML', 'display': 10, 'query': '임대차 주택임대차보호법 계약기간'}
HTML 응답 받음 - 오류 페이지가 반환되었습니다.
응답 내용 일부: <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko">
<head>
```

## 주요 원인

1. API 키(기관코드) 만료 또는 인증 문제
2. API 서버 유지보수 또는 접근 제한
3. 요청 형식의 문제
4. 네트워크 연결 문제

## 해결 방법

### 1. 개발 또는 테스트 환경에서 가상 데이터 사용

당장 개발이나 테스트를 진행해야 할 경우, `USE_MOCK_DATA` 플래그를 `True`로 설정하여 가상 데이터를 사용할 수 있습니다. 이 설정은 `app/api/endpoints/cases.py` 파일에 있습니다:

```python
# 개발 환경이나 API 연결 문제시 사용할 모의 데이터 플래그
# 실제 배포 환경에서는 False로 설정
USE_MOCK_DATA = True
```

### 2. API 키(기관코드) 갱신

국가법령정보센터 API 키를 갱신하거나 확인합니다:

1. [국가법령정보센터 API 페이지](https://open.law.go.kr/LSO/main.do)에 접속
2. 로그인 후 'API 신청/확인' 메뉴 이동
3. 현재 사용 중인 API 키의 상태 확인 및 필요시 갱신
4. 갱신된 API 키를 `.env` 파일의 `LAW_API_KEY` 값에 업데이트

### 3. API 요청 개선 사항

API 요청 시 다음 개선사항을 적용했습니다:

1. 모든 URL을 HTTPS로 변경 (보안 연결)
2. 사용자 에이전트 헤더 추가 (인증 개선)
3. 최대 3회 재시도 로직 추가 (일시적 오류 극복)
4. 지연 시간 설정 (API 서버 부하 방지)

### 4. 오류 모니터링 및 로깅

오류가 지속적으로 발생하는 경우:

1. 상세 로그를 검토하여 정확한 오류 원인 파악
2. API 제공자에게 문의하기 전에 로그와 요청 정보 준비
3. 모든 API 요청과 응답 기록 (API 호출 디버깅)

## 프로덕션 환경 전환

실제 배포 환경에서는 다음 사항을 반드시 확인하세요:

1. `USE_MOCK_DATA = False`로 설정하여 실제 API 데이터 사용
2. 유효한 API 키가 환경 변수에 설정되어 있는지 확인
3. API 요청 제한 및 할당량을 고려한 적절한 요청 빈도 설정
4. 오류 처리 및 대체 로직 구현 (API 서비스 중단에 대비)

## 추가 개선 사항

1. API 응답 캐싱: 자주 요청되는 법령이나 판례 정보 캐싱
2. 비동기 작업 큐: API 요청을 백그라운드로 처리
3. 서비스 상태 모니터링: API 서비스 상태 실시간 확인
4. 대체 데이터 소스: 국가법령정보센터 API 외에 대체 법률 정보 소스 고려
