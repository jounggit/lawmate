# LawMate API 및 Claude API 사용 가이드

## 1. 법령정보센터 API 연동 가이드

현재 법령정보센터 API 연동 시 다음과 같은 이슈가 있습니다:

### 1.1 API 접근 이슈

국가법령정보센터 API는 무료로 제공되지만, 다음과 같은 접근 제한이 있습니다:

- **API 키 등록 필요**: 정식 사용을 위해서는 법령정보센터에 API 키를 등록해야 합니다.
- **사용량 제한**: 일정 사용량을 초과하면 접근이 제한될 수 있습니다.
- **응답 형식 불안정**: 간혹 XML 대신 HTML 오류 페이지를 반환하는 경우가 있습니다.
- **판례 상세 조회 API**: 현재 500 오류를 반환하는 경우가 있으며, 안정적이지 않습니다.

### 1.2 임시 해결책

현재 구현에서는 다음과 같은 임시 해결책을 적용했습니다:

1. **API 호출 최적화**:
   - 검색 키워드를 3개 이하로 제한
   - 요청 타임아웃 30초로 설정

2. **오류 처리 강화**:
   - XML 응답이 아닌 HTML 응답 감지 및 처리
   - API 호출 실패 시 예시 데이터 반환

3. **판례 상세 조회 우회**:
   - 판례 상세 조회 API 호출을 건너뛰고 예시 데이터 사용
   - 실제 데이터와 유사한 예시 데이터 제공

### 1.3 정식 배포 전 필요 작업

실제 서비스 배포 전에 다음 작업이 필요합니다:

1. **공식 API 키 등록**:
   - 국가법령정보센터(https://open.law.go.kr)에 정식 회원 가입
   - 오픈 API 이용 신청 및 승인 대기
   - 승인 후 발급된 API 키를 설정 파일에 등록

2. **API 응답 처리 개선**:
   - 실제 API 응답 형식에 맞게 파싱 로직 업데이트
   - 판례 상세 조회 API 안정화 후 실제 호출 구현

3. **데이터 캐싱 구현**:
   - 자주 사용되는 법령 및 판례 정보 캐싱
   - 동일한 요청에 대한 API 호출 최소화

## 2. Claude API 통합 가이드

Claude API 통합 시 다음 사항을 고려하세요:

### 2.1 프롬프트 최적화

1. **입력 토큰 제한**:
   - 법령/판례 정보를 전부 제공하지 말고, 가장 관련성 높은 조항/판례만 선별적으로 제공
   - 긴 법령 조문은 핵심 부분만 추출하여 제공

2. **응답 형식 지정**:
   - 답변에 필요한 구체적인 형식과 항목을 명시
   - JSON 형식으로 응답 요청 시 명확한 스키마 제공

### 2.2 오류 처리

1. **API 호출 오류**:
   - Claude API 호출 실패 시 사용자에게 적절한 메시지 제공
   - 일시적인 서비스 불가 상황 처리

2. **응답 형식 검증**:
   - Claude 응답이 예상 형식과 다를 경우 후처리 로직 구현
   - JSON 파싱 실패 시 대체 처리 방안 마련

### 2.3 비용 최적화

1. **캐싱 전략**:
   - 유사한 법률 질문에 대한 응답 캐싱
   - 동일한 법령/판례 분석 결과 재사용

2. **단계적 접근**:
   - 초기에는 간략한 답변 제공 후, 필요시에만 상세 분석
   - 사용자가 요청할 경우에만 문서 초안 생성

## 3. 사용자 가이드

### 3.1 실행 방법

1. 기본 테스트:
   ```
   python test_mock_claude_integration.py
   ```

2. 실제 Claude API 호출 테스트:
   ```
   python test_lawmate_claude_integration.py
   ```

### 3.2 API 키 설정

.env 파일에 다음과 같이 API 키를 설정:

```
# 법률 API 설정
LAW_API_KEY=your_email_id  # 국가법령정보 API 기관코드(로그인 이메일의 ID값)

# Claude API 설정
CLAUDE_API_KEY=your_claude_api_key
```

### 3.3 주의 사항

- 실제 서비스 배포 전에 API 키의 사용량 제한을 확인하세요.
- 국가법령정보센터 API는 연구 및 비영리 목적으로만 사용 가능합니다.
- Claude API는 요금이 부과되므로 사용량을 모니터링하세요.
